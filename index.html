<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Our Book — Will you be my girlfriend?</title>
  <meta name="description" content="A little magical memory-book built for her." />
  <style>
    :root{
      --bg: #0f0b08;
      --paper: #fff9ef;
      --gold: #d9b36b;
      --text: #2b1f16;
      --muted: #6b5a4a;
      --accent: #b76d9b;
      --max-width: 1100px;
      font-family: 'Georgia', serif;
    }

    body { margin:0; background:var(--bg); color:var(--paper); }

    /* PASSWORD SCREEN */
    #lockScreen {
      position:fixed; inset:0;
      background:linear-gradient(180deg,#0f0b08,#000);
      display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      z-index:99999;
      font-family:'Georgia', serif;
    }
    #lockBox {
      background:#1a1613; padding:40px 50px;
      border-radius:14px; box-shadow:0 0 40px rgba(0,0,0,0.6);
      text-align:center;
    }
    #lockBox h2 {
      color:var(--gold); margin:0 0 20px 0;
      font-size:26px;
    }
    #passwordInput {
      padding:12px 16px; font-size:16px;
      border-radius:8px; border:1px solid #444;
      width:230px; margin-bottom:16px;
    }
    #unlockBtn {
      padding:10px 22px; font-size:16px;
      background:var(--gold); color:#000;
      border:none; border-radius:8px; cursor:pointer;
    }
    #errorMsg {
      margin-top:10px; color:#ff9b9b;
      font-size:14px; display:none;
    }

    /* BOOK STYLES */
    .stage{min-height:100vh;display:none;align-items:center;justify-content:center;padding:60px}
    .stage.show { display:flex; animation:fadeIn 1s ease forwards; }

    @keyframes fadeIn { from{opacity:0} to{opacity:1} }

    .book-wrap{width:100%;max-width:var(--max-width);position:relative}

    .book{
      display:flex;gap:28px;padding:36px;border-radius:12px;
      background:linear-gradient(180deg,#111010,#0e0c0b);
      box-shadow:0 20px 80px rgba(0,0,0,.6);
    }

    .paper{
      width:55%;min-height:60vh;background:linear-gradient(#fffef8,#f4eadf);
      border-radius:8px;padding:28px;display:grid;grid-template-columns:1fr 1fr;gap:12px;
    }

    .photo{
      width:100%;height:100%;object-fit:cover;border-radius:6px;
      box-shadow:0 8px 30px rgba(13,10,9,.35);
    }

    .text-page{
      width:45%;min-height:60vh;background:linear-gradient(#fffcf6,#fbf3e8);
      border-radius:8px;padding:40px;display:flex;flex-direction:column;
      justify-content:center;align-items:flex-start;
    }

    h1.chapter-title{font-family:'Palatino Linotype',serif;font-size:30px;margin:0;color:var(--text)}
    p.line{color:var(--muted);font-size:18px;line-height:1.45}

    .controls{
      position:absolute;bottom:18px;left:50%;transform:translateX(-50%);
      display:flex;gap:12px;
    }

    .btn{
      background:transparent;border:1px solid rgba(255,255,255,.06);
      color:var(--paper);padding:10px 14px;border-radius:9px;cursor:pointer;
      font-size:15px;
    }
    .btn.primary{
      background:linear-gradient(90deg,var(--gold),#f7daa5);
      color:var(--text);box-shadow:0 8px 30px rgba(215,170,95,.15);
    }

    .celebrate{position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
      background:rgba(0,0,0,.4); backdrop-filter:blur(2px); opacity:0; pointer-events:none;
      transition:.4s; }
    .celebrate.show { opacity:1; pointer-events:auto; }
    .celebrate .msg{background:#fffef8;padding:28px;border-radius:12px;color:var(--text);text-align:center}
  </style>
</head>
<body>

  <!-- PASSWORD LOCK -->
  <div id="lockScreen">
    <div id="lockBox">
      <h2>Enter the secret key</h2>
      <input id="passwordInput" type="password" placeholder="Password">
      <br>
      <button id="unlockBtn">Unlock</button>
      <div id="errorMsg">Incorrect password</div>
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <div class="stage" id="stage">
    <div class="book-wrap">
      <div class="book" id="book">

        <div class="paper" id="paper"></div>

        <div class="text-page">
          <h1 class="chapter-title" id="chapterTitle">Loading…</h1>
          <p class="line" id="line1"></p>
          <p class="line" id="line2"></p>
          <p class="line" id="line3"></p>
        </div>

        <canvas class="particles" id="particles"></canvas>
      </div>

      <div class="controls">
        <button class="btn" id="prevBtn">← Prev</button>
        <button class="btn primary" id="nextBtn">Next →</button>
      </div>

    </div>
  </div>

  <div class="celebrate" id="celebrate">
    <div class="msg">
      <div style="font-size:22px;margin-bottom:10px;font-weight:700">She said <span style="color:var(--gold)">Yes</span> ✨</div>
      <button class="btn primary" onclick="closeCelebrate()">Close</button>
    </div>
  </div>

  <script>
    /* -----------------------------
       PASSWORD PROTECTION (SHA-256)
    ------------------------------ */

    const PASSWORD_HASH = "c3a070eebcc14e55f4188fefd6bae515f6ad668af68b952a8b6e0ba01c7d11ee"; // onlyfortoffy

    async function sha256(str){
      const enc = new TextEncoder().encode(str);
      const hash = await crypto.subtle.digest("SHA-256", enc);
      return Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,"0")).join("");
    }

    document.getElementById("unlockBtn").onclick = async ()=>{
      const input = document.getElementById("passwordInput").value;
      const hash = await sha256(input);

      if(hash === PASSWORD_HASH){
        document.getElementById("lockScreen").style.display="none";
        document.getElementById("stage").classList.add("show");
      } else {
        document.getElementById("errorMsg").style.display="block";
      }
    };

    /* ----------------------------
       BOOK CONFIG
    ----------------------------- */

    const CONFIG = {
      chapters: 7,
      totalPhotos: 83,
      folderBase: 'photos/all',
      ext: 'jpg'
    };

    const CHAPTERS = [
      {title:'The First Moments',lines:["You told me I said the word.","I have always loved you.","Every tiny thing felt like everything to me."]},
      {title:'The Laughs & The Mess',lines:["There were meltdowns and terrible jokes.","We learned and understood eachother","We kept laughing."]},
      {title:'Travels & Tiny Adventures',lines:["Maps, trains, and late departures.","We leaned into chaos and came back holding hands.","Those days are permanent."]},
      {title:'Quiet Evenings',lines:["Slow dinners and softer silences.","You taught me how to be at ease.","I started measuring time in your breaths."]},
      {title:'The Prophecy',lines:["Someone once said we wouldn’t last past November.","The months rolled on and the prediction did not hold.","We made our own rules instead."]},
      {title:'When I Realized',lines:["I stopped counting possibilities and started counting you.","Not once but every single day.","It felt less like chance and more like choice."]},
      {title:'The Page We Write',lines:["Now, one question reigns supreme my toffy!","Will you be my girlfriend?","Click yes if our story continues."]}
    ];

    let chapterIndex = 0;
    let unusedPhotos = [];

    const paper = document.getElementById("paper");
    const chapterTitle = document.getElementById("chapterTitle");
    const lineEls = [
      document.getElementById("line1"),
      document.getElementById("line2"),
      document.getElementById("line3")
    ];
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const celebrate = document.getElementById("celebrate");

    function imgEl(src){
      const img=document.createElement("img");
      img.src=src; img.className="photo";
      img.onerror=()=>{img.style.opacity="0.2"};
      return img;
    }

    function initUnused(){
      unusedPhotos=[];
      for(let i=1;i<=CONFIG.totalPhotos;i++) unusedPhotos.push(i);
      for(let i=unusedPhotos.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [unusedPhotos[i],unusedPhotos[j]]=[unusedPhotos[j],unusedPhotos[i]];
      }
    }

    function getPhotoPaths(){
      const picks=[];
      for(let i=0;i<4;i++){
        if(unusedPhotos.length===0) break;
        const id=unusedPhotos.pop();
        picks.push(`${CONFIG.folderBase}/${id}.${CONFIG.ext}`);
      }
      return picks;
    }

    function renderChapter(i){
      chapterIndex=i;
      paper.innerHTML="";
      chapterTitle.textContent="...";
      lineEls.forEach(el=>el.textContent="");

      setTimeout(()=>{
        const paths=getPhotoPaths();
        const frag=document.createDocumentFragment();

        for(const p of paths){
          const wrap=document.createElement("div");
          wrap.style.minHeight="calc(50% - 6px)";
          wrap.appendChild(imgEl(p));
          frag.appendChild(wrap);
        }

        while(frag.childNodes.length<4){
          const clone=frag.childNodes[0]?.firstChild?.cloneNode(true);
          if(!clone) break;
          const wrap=document.createElement("div");
          wrap.style.minHeight="calc(50% - 6px)";
          wrap.appendChild(clone);
          frag.appendChild(wrap);
        }

        paper.appendChild(frag);

        const ch=CHAPTERS[i];
        chapterTitle.textContent=ch.title;
        for(let r=0;r<3;r++) lineEls[r].textContent=ch.lines[r];

        if(i===CONFIG.chapters-1){
          const btn=document.createElement("button");
          btn.className="btn primary";
          btn.style.marginTop="18px";
          btn.textContent="Yes";
          btn.onclick=()=>celebrate.classList.add("show");
          lineEls[2].appendChild(document.createElement("br"));
          lineEls[2].appendChild(btn);
        }

      },100);

      updateButtons();
    }

    function updateButtons(){
      prevBtn.disabled=chapterIndex===0;
      nextBtn.disabled=chapterIndex>=CONFIG.chapters-1;
    }

    prevBtn.onclick=()=>{ if(chapterIndex>0) renderChapter(chapterIndex-1); };
    nextBtn.onclick=()=>{ if(chapterIndex<CONFIG.chapters-1) renderChapter(chapterIndex+1); };

    (function init(){
      initUnused();
      renderChapter(0);
    })();
  </script>

</body>
</html>
